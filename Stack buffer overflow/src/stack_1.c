#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define CANARY "notabird."

void flag_shift() {}

// you can't get flag_4 and flag_5 at the same time
void flag_5() {
    printf("Good work, flag_5 done\n");
}

int main(int argc, char **argv) {
    volatile int paddy = 0;
    char canary[10] = CANARY;
    volatile int flag = 0;
    char username[20] = {0};

    if (isatty(STDIN_FILENO))
        fputs("username: ", stdout);
    if (fgets(username, 128, stdin) == 0) {
        perror("fgets");
        exit(1);
    }

    strtok(username, "\n"); // remove newline returned by fgets

    if (strcmp(username, "shirley")) {
        printf("Who is %s?\n", username);
        return 1;
    }

    if (flag == 0)
        printf("Ok, shirley. Try to get the flags next.\n");
    if (flag)
        printf("Good work, flag_1 done\n");

    if (flag != 0xdeadc0de)
        return 1;

    printf("Good work, flag_2 done\n");

    if (strcmp(canary, CANARY)) {
        printf("Canary disagrees.\n");
        return 1;
    }

    printf("Good work, flag_3 done\n");

    // __builtin_return_address(0) is the value of saved EIP register
    if ((unsigned int)__builtin_return_address(0) == 0xcafecafe)
        printf("Good work, flag_4 done\n");
}
