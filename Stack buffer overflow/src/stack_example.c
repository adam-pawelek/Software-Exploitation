#include <ctype.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void flag_2() {
    printf("flag_2 reached\n");
}

void vulnerable(char *text) {
    int flag_1 = 0;
    char buffer[64] = {0};
    void *fp = __builtin_frame_address(0);

    strcpy(buffer, text);

    printf("   flag_1 @ %p = 0x%.08x\n", &flag_1, flag_1);
    printf("   buffer @ %p = \"%s\"\n", buffer, buffer);
    printf("saved_ebp @ %p = 0x%.08x\n", fp, *(int *)fp);
    printf("saved_eip @ %p = 0x%.08x\n", fp + 4, *(int *)(fp + 4));
    printf("\n");

    if (flag_1 == 0xdeadbeef) {
        printf("flag_1 reached\n");
    }
}

int main(int argc, char **argv) {
    if (argc != 2) {
        fprintf(stderr, "Usage: %s [text]\n", argv[0]);
        exit(1);
    }

    printf("   flag_2 @ %p\n", &flag_2);

    vulnerable(argv[1]);
}

