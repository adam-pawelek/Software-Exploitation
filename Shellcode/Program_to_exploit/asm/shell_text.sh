#! /usr/bin/env bash

if [ "$#" -ne 1 ]; then
    echo "usage: $0 FILE" 1>&2
    exit 1
fi

trap "rm -f $1.out" EXIT

OUTFILE="$1.text"

# dump text section to file
objcopy -O binary                       \
        --dump-section .text=$OUTFILE   \
        "$1" "$1.out"

# translate binary to escaped text
od -An -tx1 -v "$OUTFILE"               \
| sed 's/ /\\x/g'                       \
| tr -d '\n'

echo