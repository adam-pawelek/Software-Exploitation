#include <stdio.h>
#include <unistd.h>

int global = 0;

void flag_5() { printf("Good work, flag_5 done\n"); }

int main(int argc, char **argv) {
  volatile int local = 0;
  char username[64] = {0};

  if (isatty(STDIN_FILENO))
    printf("username: ");
  fgets(username, sizeof(username), stdin);

  printf("Welcome, %s\n\n", username);

  // `fprintf(dst, fmt, args...)` writes to `dst` using format string `fmt`
  //
  // This invocation of `fprintf` is vulnerable because `username` that is
  // used as a format string is a user-controlled value. We can pass an
  // arbitrary format string as long as it is at most 64 characters, including
  // the terminating null character.
  //
  printf("---\n");  
  fprintf(stderr, username);
  printf("---\n");

  // Print the variable addresses and values for convenience.

  if (local == 0 && global == 0) {
    printf("Try to get the flags next.\n");
    return 1;
  }
  
  printf("Good work, flag_0 done\n");

  // You can use different inputs for all flags if you wish.
  //
  // Note that some of the flags {1,2} and {3,4} are mutually exclusive
  // so it is not possible to get them with same input.
  //
  if (local == 42)
    printf("Good work, flag_1 done\n");
  if (local == 0xb0b51ed5)
    printf("Good work, flag_2 done\n");
  if (global == 84)
    printf("Good work, flag_3 done\n");
  if (global == 0x7e1eca57)
    printf("Good work, flag_4 done\n");

  return 0;
}
